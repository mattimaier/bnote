/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2016 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['jquery.sap.global','sap/ui/dt/ManagedObjectObserver','sap/ui/dt/DOMUtil'],function(q,M,D){"use strict";var C=M.extend("sap.ui.dt.ControlObserver",{metadata:{library:"sap.ui.dt",properties:{},associations:{"target":{"type":"sap.ui.core.Control"}},events:{"domChanged":{}}}});C.prototype.init=function(){M.prototype.init.apply(this,arguments);this._bVisible=false;this._fnFireDomChanged=this._fireDomChangedIfVisible.bind(this);this._oControlDelegate={onAfterRendering:this._onAfterRendering,onBeforeRendering:this._onBeforeRendering};};C.prototype.observe=function(c){M.prototype.observe.apply(this,arguments);this._startObservers();c.addEventDelegate(this._oControlDelegate,this);};C.prototype.unobserve=function(){var c=this.getTargetInstance();if(c){c.removeDelegate(this._oControlDelegate,this);}this._stopObservers();delete this._oMutationObserver;M.prototype.unobserve.apply(this,arguments);};C.prototype._onBeforeRendering=function(){this._stopObservers();};C.prototype._onAfterRendering=function(){this._startObservers();this.fireDomChanged();};C.prototype._startMutationObserver=function(){var t=this;var a=window.MutationObserver||window.WebKitMutationObserver;var d=this.getTargetInstance().getDomRef();if(a&&d){this._oMutationObserver=this._oMutationObserver||new a(function(m){var v=D.isVisible(d);if(v||t._bVisible!==v){t.fireDomChanged();}t._bVisible=v;});this._oMutationObserver.observe(d,{childList:true,subtree:true,attributes:true,characterData:true});}};C.prototype._stopMutationObserver=function(){if(this._oMutationObserver){this._oMutationObserver.disconnect();}};C.prototype._startResizeObserver=function(){q(window).on("resize",this._fnFireDomChanged);};C.prototype._stopResizeObserver=function(){q(window).off("resize",this._fnFireDomChanged);};C.prototype._startObservers=function(){this._bVisible=D.isVisible(this.getTargetInstance().$());this._startMutationObserver();this._startResizeObserver();};C.prototype._stopObservers=function(){this._stopResizeObserver();this._stopMutationObserver();};C.prototype._fireDomChangedIfVisible=function(){if(this._bVisible){this.fireDomChanged();}};return C;},true);
