/*!
 * UI development toolkit for HTML5 (OpenUI5)
 * (c) Copyright 2009-2017 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global"],function(q){"use strict";var C={channels:{},onMessageChecks:[]};var o=q.sap.getUriParameters().get("sap-ui-xx-support-origin");var a=o;var f=q.sap.getUriParameters().get("sap-ui-xx-frame-identifier")||'_unnamed_frame_-_use_message_origin_';if(!a){var m=new window.URI(q.sap.getModulePath("sap.ui.support"));var p=m.protocol()===""?window.location.protocol.replace(":",""):m.protocol();var h=m.host()===""?window.location.host:m.host();a=p+"://"+h;}C.origin=a;C.subscribe=function(c,b,d){if(!this.channels[c]){this.channels[c]=[{callback:b,context:d}];return;}this.channels[c].push({callback:b,context:d});};C.publish=function(c,P){var r=this._getReceivingWindow(),d={channelName:c,params:P,_frameIdentifier:f,_origin:window.location.href};r.postMessage(d,this.origin);};C.destroyChanels=function(){C.channels={};};C._getReceivingWindow=function(){if(window.communicationWindows&&window.communicationWindows.hasOwnProperty("supportTool")){return window.communicationWindows.supportTool;}return window.opener||window.parent;};C._onmessage=function(e){var c=C.onMessageChecks.every(function(M){return M.call(null,e);});if(!c){q.sap.log.error("Message was received but failed validation");return;}var b=e.data.channelName,d=e.data.params,g=C.channels[b];if(!g){return;}g.forEach(function(i){i.callback.apply(i.context,[d]);});};if(window.addEventListener){window.addEventListener("message",C._onmessage,false);}else{window.attachEvent("onmessage",C._onmessage);}if(o){C.publish("COMM_BUS_INTERNAL","READY");}return C;},true);
